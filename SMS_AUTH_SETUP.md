# Настройка SMS авторизации и личного кабинета

## Что было реализовано

### 1. SMS авторизация

-   **Регистрация по SMS**: Пользователь вводит имя и номер телефона, получает SMS с кодом подтверждения
-   **Вход по SMS**: Пользователь вводит номер телефона, получает SMS с кодом для входа
-   **Верификация номера**: Проверка 4-значного кода из SMS с ограничением по времени (5 минут)

### 2. Личный кабинет

-   **Дашборд**: Отображение информации о пользователе и статистики бронирований
-   **История бронирований**: Таблица со всеми бронированиями пользователя с пагинацией
-   **Редактирование профиля**: Возможность изменить имя и email (телефон нельзя изменить)
-   **Удаление аккаунта**: Возможность удалить аккаунт с подтверждением пароля

### 3. Безопасность

-   **Middleware проверки телефона**: Доступ к личному кабинету только с подтвержденным номером
-   **Временные SMS коды**: Коды действительны 5 минут
-   **Нормализация номеров**: Автоматическое приведение номеров к формату +7XXXXXXXXXX

## Настройка

### 1. Настройка SMS сервиса

В файле `.env` добавьте настройки для SMS сервиса:

```env
SMS_LOGIN=your_sms_login
SMS_PASSWORD=your_sms_password
```

### 2. Выполнение миграций

```bash
php artisan migrate
```

### 3. Настройка маршрутов

Маршруты уже настроены в `routes/auth.php` и `routes/web.php`:

-   `/auth/sms-register` - регистрация по SMS
-   `/auth/sms-login` - вход по SMS
-   `/profile` - личный кабинет
-   `/profile/edit` - редактирование профиля

## Использование

### Для пользователей:

1. **Регистрация**: Перейти на `/auth/sms-register`, ввести имя и номер телефона
2. **Подтверждение**: Ввести код из SMS на странице `/auth/verify-sms`
3. **Вход**: Перейти на `/auth/sms-login`, ввести номер телефона
4. **Подтверждение входа**: Ввести код из SMS на странице `/auth/verify-login-sms`
5. **Личный кабинет**: После авторизации доступен по адресу `/profile`

### Для разработчиков:

-   SMS коды генерируются случайно (4 цифры)
-   Номера телефонов нормализуются к формату +7XXXXXXXXXX
-   Бронирования связываются с пользователем по номеру телефона
-   Все представления используют Bootstrap для стилизации

## Файлы, которые были созданы/изменены:

### Новые файлы:

-   `database/migrations/2025_01_01_000000_add_phone_fields_to_users_table.php`
-   `app/Http/Controllers/Auth/SmsAuthController.php`
-   `app/Http/Middleware/EnsurePhoneVerified.php`
-   `resources/views/auth/sms-register.blade.php`
-   `resources/views/auth/verify-sms.blade.php`
-   `resources/views/auth/sms-login.blade.php`
-   `resources/views/auth/verify-login-sms.blade.php`
-   `resources/views/profile/dashboard.blade.php`

### Измененные файлы:

-   `app/Models/User.php` - добавлены поля для SMS и связь с бронированиями
-   `app/Models/Reserv.php` - добавлена связь с пользователем
-   `app/Http/Controllers/ProfileController.php` - добавлен дашборд
-   `routes/auth.php` - добавлены маршруты SMS авторизации
-   `routes/web.php` - добавлены маршруты личного кабинета
-   `resources/views/layouts/navigation.blade.php` - обновлена навигация
-   `resources/views/profile/edit.blade.php` - обновлен дизайн
-   `bootstrap/app.php` - зарегистрирован middleware

## Возможные улучшения:

1. Добавить повторную отправку SMS кода
2. Добавить ограничения на количество попыток ввода кода
3. Добавить уведомления об успешных/неуспешных операциях
4. Добавить возможность смены номера телефона
5. Добавить экспорт истории бронирований

